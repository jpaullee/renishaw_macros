%
O09994  ( B AXIS TILT AND C AXIS ROT AXIS MRZP)

(EACH LOCATION WILL BE PROBED TWICE FOR IMPROVED ACCURACY)
(MODIFIED PROGRAM TO FEED TO ROTARY PROBING LOCATIONS)
(CREATED BY ERIC RODRIGUEZ 7/21/2016)
(REVISED 12/12/2016)
(UPDATED B AXIS PROBING POSITIONS FOR DPRNT)
(ADDED HOME POSITION RETURN)
(ADDED DPRNT OUTPUT)
(ADDED 90 DEGREE PROGRAM)

( OUTPUT MRZP SETTING VALUES ) 
( COPY VALUE FROM THE MACRO VARIABLE INTO THE SETTING )
( MACRO #10121 IS SETTING 255 - MRZP X OFFSET )
( MACRO #10122 IS SETTING 256 - MRZP Y OFFSET ) 
( MACRO #10123 IS SETTING 257 - MRZP Z OFFSET ) 

(DPRNT- SETTING 261 MUST BE SET TO FILE)
(DPRNT- SETTING 262 MUST HAVE A PATH DESTINATION)

(NOT FOR USE ON COLDFIRE MACHINES) 
(PROGRAM CREATED FOR B AXIS TILT AND C AXIS ROTARY) 
(WORKS IN INCH AND METRIC)

( G65 P9994 A B C ) 
( A1 ROUGH A2 FINISH ) 
( B GAGE BALL DIAMETER FINISH CYCLE ) 
( C BORE DIAMETER ROUGH CYCLE ) 
 
( THIS PROGRAM WILL WRITE OVER) 
( G154 P90 AND G154 P91 ) 

(LIMIT LOOK AHEAD) 
G103 P1 
 
(SAFETY LINE) 
G90 G40 G80 G50 G69 
G255 G49 
 
( CLEAR G154 P90 OFFSETS ) 
#15781= 0 
#15782= 0 
#15783= 0 
#15784= 0 
#15785= 0 
 
( CLEAR G154 P91 OFFSETS ) 
#15801= 0 
#15802= 0 
#15803= 0 
#15804= 0 
#15805= 0 

( METRIC CHECK ) 
( CHECKS SETTING 9 )
#15643=#30003.078
#15643=#15643/25.4
#10997=500.
#5= 1. 
IF [ #20009 EQ 1 ] GOTO4 
GOTO5 
N4 
#15643=#15643*25.4
#10997=12700
#5= 25.4 
N5 

( A / B AND C AXIS HOME CHECK ) 
 
IF [ #5026 GT [ 0.02 ] ] GOTO904 
 
IF [ #5026 LT [ -0.02 ] ] GOTO904 
 
IF [ #5025 GT [ 0.02 ] ] GOTO905 
 
IF [ #5025 LT [ -0.02 ] ] GOTO905 
 
IF [ #5024 GT [ 0.02 ] ] GOTO909 
 
IF [ #5024 LT [ -0.02 ] ] GOTO909 
  
( A CALL CHECK ) 
 
IF [ #1 EQ 2 ] GOTO10 (FINISH CYCLE) 
 
IF [ #1 EQ 1 ] GOTO20 (ROUGH CYCLE) 
 
GOTO901 
 
(---------------------------------------) 
 
N10 (FINISH CYCLE ) 
 
( B CALL CHECK ) 
 
IF [ #2 LE 0 ] GOTO902 ( B CALL CHECK ) 
 
IF [ #2 EQ #0 ] GOTO902 ( B CALL CHECK ) 

(---------------------------------------) 

(PROGRAM SELECTION)

N11 #501= 0. ;

N5 M109 P501(WOULD YOU LIKE TO RUN THE UMC B90 MRZP PROGRAM? PRESS Y FOR YES OR N FOR NO) ;

IF [ #501 EQ 0. ] GOTO5 ;

IF [ #501 EQ 78. ] GOTO1011 

IF [ #501 EQ 89. ] GOTO2011 

GOTO11;


N1011
(---------------------------------------)

(DESIGNED TO PROBE 3 POINTS /-35 DEG /0 DEG/55 DEG FOR B AXIS)
(DESIGNED TO PROBE 3 POINTS /0 /DEG /90 DEG /180 DEG FOR C AXIS) 

 
(RECORD MACHINE ROTARY ZERO POINT) 
#10= #20255 ( SETTING 255 - MRZP X OFFSET )
#11= #20256 ( SETTING 256 - MRZP Y OFFSET ) 
#12= #20257 ( SETTING 257 - MRZP Z OFFSET ) 

( MACHINE ROTARY ZERO PARAM CHECK ) 
 
IF [ #10 EQ 0 ] GOTO906 
 
IF [ #10 EQ #0 ] GOTO906 
 
IF [ #11 EQ 0 ] GOTO907 
 
IF [ #11 EQ #0 ] GOTO907 
 
IF [ #12 EQ 0 ] GOTO908 
 
IF [ #12 EQ #0 ] GOTO908 
 
(PROBE TARGET OFFSET) 
G65 P9995 W154.9 A20. H - [ #2 * 0.5 ] 
G04 P1. 
G65 P9995 W154.9 A11. D#2 E - [ #2 * 0.65 ] 
 
(------------------------------------) 
 
( ROTATION ) 
 
(MOVE TO FIRST LOCATION) 
G49 
G1G154P83Z0. F#10997

(G00 G90 G53 Z0.) 
G00 G90 G154 P90 X0. Y0. 
T#3026 
G43 H#3026 
 
(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ 0.25 * #5 ] F [ 100. * #5 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
 
G103 P1 

G49 
G1G154P83Z0. F#10997
 
(G00 G53 Z0.) 
G65 P9833 
G04 P300 
 
G103 P1  

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 
 
(RECORD PROBED LOCATION) 
#13= #15801 (X) 
#14= #15802 (Y) 
#15= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026 
 
(DIFFERENCE MRZP AND PROBE LOCATION) 
#16= #10 - #13 (X) 
#17= #11 - #14 (Y) 
#18= + [ #12 - #15 ] (Z) 

#10711= #13 (X)
#10721= #14 (Y)
(****************************************************) 
POPEN

DPRNT[UNITS*#4006[20]] 
DPRNT[TYPE*2] 
#10011= FIX[ #3011 / 10000 ] 
#10012= FIX[ [ #3011 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3011 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[DATE*20#10011[40]*#10012[20]*#10013[20]] 
#10011= FIX[ #3012 / 10000 ] 
#10012= FIX[ [ #3012 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3012 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[TIME*#10011[20]*#10012[20]*#10013[20]] 
DPRNT[AXISLABELS*A*B*C*X*Y*Z] 

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

#10121= #20255
#10122= #20256
#10123= #20257

DPRNT[C AXIS]
DPRNT[OLD MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 
 
( SET SECOND LOCATION ) 
#15801= [ #10 - #17 ] (X) 
#15802= [ #11 + #16 ] (Y) 
  
(MOVE TO SECOND LOCATION) 

G49 
G1G154P83Z0. F#10997

G154 P91 
(G00 G90 G53 Z0.) 
G01 C90. X0. Y0. F#10997 
G43 H#3026 
 
(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z0. 
 
G103 P1 
G04 P300 

G00 G154 P91 X0. Y0. 

(PROBE LOCATION 2) 
G04 P1. 
G65 P9810 Z [ #2 * 0.25 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
G103 P1 

G49 
G1G154P83Z0. F#10997

(G00 G53 Z0.) 
G65 P9833 
G04 P300  
 
G103 P1 
 
(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 
 
 
(RECORD PROBED LOCATION) 
#21= #15801 (X) 
#22= #15802 (Y) 
#23= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026 
 
#10712= #21(X)
#10722= #22(Y)
 
(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 

( SET THIRD LOCATION ) 
#15801= [ #10 + #16 ] (X) 
#15802= [ #11 + #17 ] (Y) 
 
(MOVE TO THIRD LOCATION) 

G49 
G1G154P83Z0. F#10997

G154 P91 
(G00 G53 Z0.) 
G01 C180. X0. Y0. F#10997 
G43 H#3026 
 
(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z0. 
 
G103 P1 
 
G04 P300 

G00 G154 P91 X0. Y0. 

(PROBE LOCATION 2) 
G04 P1. 
G65 P9810 Z [ #2 * 0.25 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
G103 P1 

G49 
G1G154P83Z0. F#10997 

(G00 G53 Z0.) 
G65 P9833 
G04 P300  
 
G103 P1 
 
(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 
 
(RECORD PROBED LOCATION) 
#24= #15801 (X) 
#25= #15802 (Y) 
#26= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026 

#10713= #24 (X) 
#10723= #25 (Y) 
 
G103P1

#10711= [ ROUND[ #10711 * 10000 ] ] / 10000 
#10721= [ ROUND[ #10721 * 10000 ] ] / 10000 
#10712= [ ROUND[ #10712 * 10000 ] ] / 10000 
#10722= [ ROUND[ #10722 * 10000 ] ] / 10000 
#10713= [ ROUND[ #10713 * 10000 ] ] / 10000 
#10723= [ ROUND[ #10723 * 10000 ] ] / 10000

IF[#10712-#10711 EQ 0] THEN #10712=#10712+0.0001

IF[#10713-#10712 EQ 0] THEN #10713=#10713+0.0001

#10715=[[#10722]-[#10721]]/[[#10712]-[#10711]] 
#10716=[[#10723]-[#10722]]/[[#10713]-[#10712]]

#10714=[[[#10715]*[#10716]]*[[#10721]-[#10723]]+[[#10716]*[[#10711]+[#10712]]]-[[#10715]*[[#10712]+[#10713]]]]/[[2.]*[[#10716]-[#10715]]]

#10724=[[-1.]/[#10715]]*[[#10714]-[[#10711]+[#10712]]/[2.]]+[[#10721]+[#10722]]/[2.]

#10000= #10714 
#10001= #10724  
#10002= 0 
 
(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
DPRNT[NEW MRZP VALUES]
DPRNT[#10000[44]*#10001[44]*#10002[44]]
DPRNT[END*DATA] 
PCLOS 
G103

(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 

G49 
G1G154P83Z0. F#10997

(G00 G53 Z0.) 
G00 G53 X#13 Y#14 
G01 C0. F#10997 

(TILT)

GOTO999 
 
(------------------------------------) 
 
N20 ( ROUGH CYCLE) 
( C CALL CHECK ) 
IF [ #3 LE 0 ] GOTO903 ( C CALL CHECK ) 
IF [ #3 EQ #0 ] GOTO903 ( C CALL CHECK ) 
( D CALL CHECK )
IF [[ #7 LT -360.]OR [#7 GT 360.]] GOTO903
IF [ #7 EQ #0] GOTO903
( E CALL CHECK )
IF [ #8 LT 0.]  GOTO903
IF [ #8 EQ #0] GOTO903
G65 P9832 
 
G91 G31 Z - [ 0.5 * #5 ] F [ 50. * #5 ] 

G65 P9995 W154.91 A10. D#3 
G04 P300 

G65 P9832 
 
G91 G31 Z [ 0.5 * #5 ] F [ 50. * #5 ] 
#24= [ [#3/2 + #8] * COS[#7] ]
#25= [ [#3/2 + #8] * SIN[#7] ]

G31 G91 X#24 Y#25 F [ 50. * #5 ] M78
 
G65 P9995 W154.91 A20. H - [ 0.5 * #5 ] 
G04 P300 
 
G31 G90 G154 P1 X0. Y0. F [ 50. * #5 ]
 
G103 P1 
 
(RECORD PROBED LOCATION) 
#121= #15801 ( SETTING 255 - MRZP X OFFSET ) 
#122= #15802 ( SETTING 256 - MRZP Y OFFSET ) 
#123= #15803 ( SETTING 257 - MRZP Z OFFSET ) 
 
#123= [ #123 + #11 ] ( TABLE TO MRZP DISTANCE Z ADJUSTMENT ) 
 
( CONVERSION NO LONGER NEEDED )
(#106= [ #20255 * 25.4 / #5 ] X PARAMETER) 
(#107= [ #20256 * 25.4 / #5 ] Y PARAMETER) 
(#108= [ #20257 * 25.4 / #5 ] Z PARAMETER)  
 
GOTO8888
 
(--------------------------------------) 
 
N900 ( ALARMS ) 
 
N901 
#3000= 1 ( NO A CALL IN G65 LINE ) 
 
N902 
#3000= 2 ( NO B CALL IN G65 LINE ) 
 
N903 
#3000= 3 ( NO C CALL IN G65 LINE ) 
 
N904 
#3000= 4 (HOME C AXIS ) 
 
N905 
#3000= 5 (HOME B AXIS ) 
 
N906 
#3000= 6 (SETTING 255 IS 0 - RUN MRZP ROUGH 1ST & ENTER VALUE) 
 
N907 
#3000= 7 (SETTING 256 IS 0 - RUN MRZP ROUGH 1ST & ENTER VALUE) 
 
N908 
#3000= 8 (SETTING 257 IS 0 - RUN MRZP ROUGH 1ST & ENTER VALUE) 
 
N909 
#3000= 9 (HOME A AXIS) 
 

N999 
(------------------------------------) 
 
(TILT )
 
(MOVE TO FIRST LOCATION) 

G49 
G1G154P83Z0. F#10997
 
(G00 G90 G53 Z0.) 
G00 G90 G154 P90 X0. Y0. 

#15801= #15781
#15802= #15782
#15803= #15783
#15804= #15784
#15805= #15785 

T#3026 
G43 H#3026 

(------------------------------------) 

( TILT 1) 
 
( CALC -35 DEG LOCATION) 
( TILT ) 
#20= [ #18 * SIN[ - 35 ] ] (X) 
#21= [ #18 * COS[ - 35 ] ] (Z) 
IF [ #16 GT 0 ] GOTO500 ( SINK OR LIFT) 
(SINK) 
#22= - [ #16 * COS[ 35 ] ] (X) 
#23= [ #16 * SIN[ 35 ] ] (Z) 
 
GOTO600 
N500 
(LIFT) 
#22= - [ #16 * COS[ 35 ] ] (X) 
#23= [ #16 * SIN[ 35 ] ] (Z) 
 
N600 
 
( SET FIXTURE LOCATION ) 
#15801= [ #10 + #20 + #22 ] (X) 
#15802= #14 (Y) 
#15803= [ #12 - #21 + #23 ] (Z) 
 
(MOVE TO -35. DEG LOCATION) 

G49 
G1G154P83Z0. F#10997

G154 P91 
(G00 G53 Z0.) 
G01 G154 P91 B-35. X0. Y0. F#10997 
G43 H#3026 
 
(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G04 P300 
G65 P9814 S154.91 D#2 Z0. 
G103 P1 

G04 P300 

G00 G154 P91 X0. Y0. 

(PROBE LOCATION 2) 
G04 P1. 
G65 P9810 Z [ #2 * 0.25 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
G103 P1 

G49 
G1G154P83Z0. F#10997
 
(G00 G53 Z0.) 
G65 P9833 
G04 P300  
G103 P1 
 
(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 
 
(RECORD PROBED LOCATION) 
#24= #15801 (X) 
#25= #15802 (Y) 
#30= #15803 (Z) 
#27= #24 - #13 ( INC TO CENTER X) 
#31= [ [ SQRT[ 3 ] ] * #27 ] ( INC TO CENTER Z) 
#31= [ ABS[ #31 ] ] 
#15804= #5024
#15805= #5025 
#15806= #5026 

#10712= #30
#10722= #24 
 
(****************************************************) 
POPEN

DPRNT[UNITS*#4006[20]] 
DPRNT[TYPE*2] 
#10011= FIX[ #3011 / 10000 ] 
#10012= FIX[ [ #3011 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3011 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[DATE*20#10011[40]*#10012[20]*#10013[20]] 
#10011= FIX[ #3012 / 10000 ] 
#10012= FIX[ [ #3012 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3012 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[TIME*#10011[20]*#10012[20]*#10013[20]] 
DPRNT[AXISLABELS*A*B*C*X*Y*Z] 

#10011=#15804
#10012=#15805
#10013=#15806
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

#10121= #20255
#10122= #20256
#10123= #20257

DPRNT[B AXIS]
DPRNT[OLD MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 
( TILT 2)
 
(MOVE TO FIRST LOCATION) 
G49 
G1G154P83Z0. F#10997

(G00 G90 G53 Z0.) 
G00 G90 G154 P90 (P91) X0. Y0. B0.
T#3026 
G43 H#3026 
 
(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ 0.25 * #5 ] F [ 100. * #5 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
 
G103 P1 
 
G04 P300 

(PROBE LOCATION 2) 
G04 P1. 
G65 P9810 Z [ 0.25 * #5 ] F [ 100. * #5 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
 
G103 P1 
G49 
G1G154P83Z0. F#10997

(G00 G53 Z0.) 
G65 P9833 
G04 P300
 
G103 P1 
 
(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 
 
(RECORD PROBED LOCATION) 
#13= #15801 (X) 
#14= #15802 (Y) 
#15= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026  
 
(DIFFERENCE MRZP AND PROBE LOCATION) 
#16= #10 - #13 (X) 
#17= #11 - #14 (Y) 
#18= + [ #12 - #15 ] (Z) 
 
#10711=#15 
#10721=#13

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]] 
(****************************************************) 
#15804=0
#15805=0 
#15806=0 

(------------------------------------) 
 
( CALC 55 DEG LOCATION) 
( TILT ) 
#20= [ #18 * SIN[ 55 ] ] (X) 
#21= [ #18 * COS[ 55 ] ] (Z) 
IF [ #16 LT 0 ] GOTO300 ( SINK OR LIFT) 
(SINK) 
#22= - [ #16 * COS[ 55 ] ] (X) 
#23= - [ #16 * SIN[ 55 ] ] (Z) 
 
GOTO400 
N300 
(LIFT) 
#22= - [ #16 * COS[ 55 ] ] (X) 
#23= - [ #16 * SIN[ 55 ] ] (Z) 
 
N400 
 
( SET FIXTURE LOCATION ) 
#15801= [ #10 + #20 + #22 ] (X) 
#15802= #14 (Y) 
#15803= [ #12 - #21 + #23 ] (Z) 
 
( MOVE TO E+ DEG LOCATION ) 

G49 
G1G154P83Z0. F#10997

G154 P91 
(G00 G53 Z0.) 
G01 G154 P91 B55. X0. Y0. F#10997 
G43 H#3026 
 
(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G04 P300 
G65 P9814 S154.91 D#2 Z0. 
G103 P1 

G04 P300 
 
G00 G154 P91 X0. Y0. 

(PROBE LOCATION 2) 
G04 P1. 
G65 P9810 Z [ #2 * 0.25 ] 
G04 P300 
G65 P9811 S154.91 Z0. 
G04 P300 
G65 P9814 S154.91 D#2 Z - [ #2 / 2 ] 
G103 P1 

G49 
G1G154P83Z0. F#10997

(G00 G53 Z0.) 
G65 P9833 
G04 P300  
 
G103 P1 
 
(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 
 
(RECORD PROBED LOCATION) 
#24= #15801 (X) 
#25= #15802 (Y) 
#26= #15803 (Z) 
#27= [ #24 - #13 ] ( INC TO CENTER X) 
#28= [ [ SQRT[ 3 ] ] * #27 ] ( INC TO CENTER Z) 
#28= [ ABS[ #28 ] ] 
#15804= #5024
#15805= #5025 
#15806= #5026 

#10713= #26
#10723= #24 
 
(------------------------------------) 
 
G103 P1 
G04 P1. 
G04 P1 
G04 P1 
G04 P1 
 
G49 
G1G154P83Z0. F#10997
 
(G00 G90 G53 Z0.) 
G00 G90 G53 B0. 
G00 G90 G53 X#13 Y#14 

N9999 

G103P1

#10711= [ ROUND[ #10711 * 10000 ] ] / 10000 
#10721= [ ROUND[ #10721 * 10000 ] ] / 10000 
#10712= [ ROUND[ #10712 * 10000 ] ] / 10000 
#10722= [ ROUND[ #10722 * 10000 ] ] / 10000 
#10713= [ ROUND[ #10713 * 10000 ] ] / 10000 
#10723= [ ROUND[ #10723 * 10000 ] ] / 10000

IF[#10712-#10711 EQ 0] THEN #10712=#10712+0.0001

IF[#10713-#10712 EQ 0] THEN #10713=#10713+0.0001

#10715=[[#10722]-[#10721]]/[[#10712]-[#10711]] 
#10716=[[#10723]-[#10722]]/[[#10713]-[#10712]]

#10714=[[[#10715]*[#10716]]*[[#10721]-[#10723]]+[[#10716]*[[#10711]+[#10712]]]-[[#10715]*[[#10712]+[#10713]]]]/[[2.]*[[#10716]-[#10715]]]

#10724=[[-1.]/[#10715]]*[[#10714]-[[#10711]+[#10712]]/[2.]]+[[#10721]+[#10722]]/[2.]

#10002= #10714(Z) 
#10003= #10724(X)

#10004= [ #10000 * - 1. ] - [ #10003 * - 1. ]
#10005= #10001
#10006= #10003

#10000= [ #10000 * - 1. ] + [ #10003 * - 1. ] 
#10000= #10000 / 2 

#10000= #10000 * -1. 

#10121=#10000
#10122=#10001
#10123=#10002

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
DPRNT[NEW FINAL MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[END*DATA] 
PCLOS 
G103

(****************************************************)
#15804=0
#15805=0 
#15806=0 

(------------------------------------)

G28 B0. 
N8888
G103
M30 


N2011

M130(Memory/09000/UMC_90_MRZP.jpg)


M00
(90 DEGREE MRZP PROGRAM)
(PLEASE READ NOTES BELOW BEFORE PROCEEDING) 
(****NOTES****)
(ONLY USE ON UMC-750 & UMC-750SS NGC MACHINES)
(ONLY USE WITH STRAIGHT MRZP SPHERE ASSEMBLY)
(SPHERE ASSEMBLY MUST BE MOUNTED NEAR THE CENTER OF PLATTER) 
(*************)


(WORKS IN INCH AND METRIC)
(LAST UPDATED 10/25/2016)
( G65 P9994 A B C ) 
( A1 ROUGH A2 FINISH) 
( B GAGE BALL DIAMETER FINISH CYCLE ) 
( C BORE DIAMETER ROUGH CYCLE ) 

( OUTPUT MRZP PARAMETER VALUES ) 
( 106 IS X PARAMETER ) 
( 107 IS Y PARAMETER) 
( 108 IS Z PARAMETER) 

( OUTPUT MRZP UNIT VALUES ) 
( 121 IS X MACHINE UNIT ) 
( 122 IS Y MACHINE UNIT) 
( 123 IS Z MACHINE UNIT) 

( THIS PROGRAM WILL WRITE OVER) 
( G154 P90 AND G154 P91 ) 

(LIMIT LOOK AHEAD) 
G103 P1 
G04 P200 
G04 P1 
G04 P1 
G04 P1 
G04 P1 
G04 P1 
G04 P1 
G04 P1 

(SAFETY LINE) 
G90 G40 
G255 G49 

( CLEAR G154 P90 OFFSETS ) 
#15781= 0 
#15782= 0 
#15783= 0 
#15784= 0 
#15785= 0 

( CLEAR G154 P91 OFFSETS ) 
#15801= 0 
#15802= 0 
#15803= 0 
#15804= 0 
#15805= 0 

( METRIC CHECK ) 
#5= 1. 
#4= 0.2362 (STYLUS DIAM INCHES) 
IF [ #20009 EQ 1 ] GOTO44 
GOTO55 
N44 
#5= 25.4 
#4= 6. (STYLUS DIAM METRIC) 
N55 

( B AND C AXIS HOME CHECK ) 

IF [ #5026 GT [ 0.02 ] ] GOTO904 

IF [ #5026 LT [ -0.02 ] ] GOTO904 

IF [ #5025 GT [ 0.02 ] ] GOTO905 

IF [ #5025 LT [ -0.02 ] ] GOTO905 



(---------------------------------------) 

N10 (FINISH CYCLE ) 

( B CALL CHECK ) 

IF [ #2 EQ 0 ] GOTO902 ( B CALL CHECK ) 

IF [ #2 EQ #1 ] GOTO902 ( B CALL CHECK ) 


(RECORD MACHINE ROTARY ZERO POINT) 
#10= #20255 ( SETTING 255 - MRZP X OFFSET )
#11= #20256 ( SETTING 256 - MRZP Y OFFSET ) 
#12= #20257 ( SETTING 257 - MRZP Z OFFSET ) 

( PUT IN INCH DECIMAL ) 
(#10= [ #10 / 10000 ] MACHINE ROTARY ZERO X) 
(#11= [ #11 / 10000 ] MACHINE ROTARY ZERO Y) 
(#12= [ #12 / 10000 ] MACHINE ROTARY ZERO Z) 

( METRIC CONVERSION ) 
(#10= #10 * #5 )
(#11= #11 * #5 )
(#12= #12 * #5) 

( MACHINE ROTARY ZERO PARAM CHECK ) 

IF [ #10 EQ 0 ] GOTO906 

IF [ #10 EQ #0 ] GOTO906 

IF [ #11 EQ 0 ] GOTO907 

IF [ #11 EQ #0 ] GOTO907 

IF [ #12 EQ 0 ] GOTO908 

IF [ #12 EQ #0 ] GOTO908 


(PROBE TARGET OFFSET) 
G65 P9995 W154.9 A20. H - [ #2 * 0.5 ] 
G04 P1. 
G65 P9995 W154.9 A11. D#2 E - [ #2 * 0.65 ] 

(------------------------------------) 

( ROTATION ) 

(MOVE TO FIRST LOCATION) 
G00 G90 G53 Z0. 
G00 G90 G154 P90 X0. Y0. 
T#3026 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ 0.25 * #5 ] F [ 100. * #5 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
G65 P9814 S154.91 D#2 Z - [ [ #2 / 2 ] + [ #4 / 2 ] ] 

G103 P1 

G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#13= #15801 (X) 
#14= #15802 (Y) 
#15= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026

(DIFFERENCE MRZP AND PROBE LOCATION) 
#16= #10 - #13 (X) 
#17= #11 - #14 (Y) 
#18= + [ #12 - #15 ] (Z) 

(****************************************************) 
POPEN

DPRNT[UNITS*#4006[20]] 
DPRNT[TYPE*2] 
#10011= FIX[ #3011 / 10000 ] 
#10012= FIX[ [ #3011 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3011 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[DATE*20#10011[40]*#10012[20]*#10013[20]] 
#10011= FIX[ #3012 / 10000 ] 
#10012= FIX[ [ #3012 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3012 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[TIME*#10011[20]*#10012[20]*#10013[20]] 
DPRNT[AXISLABELS*A*B*C*X*Y*Z] 

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

#10121= #20255
#10122= #20256
#10123= #20257

DPRNT[C AXIS]
DPRNT[OLD MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)
#15804=0
#15805=0 
#15806=0 

(------------------------------------) 

( SET SECOND LOCATION ) 
#15801= [ #10 - #17 ] (X) 
#15802= [ #11 + #16 ] (Y) 

(MOVE TO SECOND LOCATION) 
G154 P91 
G00 G90 G53 Z0. 
G00 C90. X0. Y0. 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
G65 P9814 S154.91 D#2 Z - [ #4 / 2 ] 

G103 P1 

G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#21= #15801 (X) 
#22= #15802 (Y) 
#23= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 

(------------------------------------) 

( SET THIRD LOCATION ) 
#15801= [ #10 + #16 ] (X) 
#15802= [ #11 + #17 ] (Y) 

(MOVE TO THIRD LOCATION) 
G154 P91 
G00 G53 Z0. 
G00 C180. X0. Y0. 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
G65 P9814 S154.91 D#2 Z - [ #4 / 2 ] 

G103 P1 

G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#24= #15801 (X) 
#25= #15802 (Y) 
#26= #15803 (Z) 
#15804= #5024
#15805= #5025 
#15806= #5026 

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 

( SET FOURTH LOCATION ) 
#15801= [ #10 + #17 ] (X) 
#15802= [ #11 - #16 ] (Y) 

(MOVE TO FOURTH LOCATION) 
G154 P91 
G00 G53 Z0. 
G00 C270. X0. Y0. 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
G65 P9814 S154.91 D#2 Z - [ #4 / 2 ] 

G103 P1 

G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#27= #15801 (X) 
#28= #15802 (Y) 
#29= #15803 (Z) 

#15804= #5024
#15805= #5025 
#15806= #5026 

G103 P1 
G04 P1. 
G04 P1 
G04 P1 
G04 P1 

(NEW ROTARY CENTER LOCATION) 
#121= [ [ #27 + #24 + #21 + #13 ] / 4 ] (X UNIT) 
#122= [ [ #28 + #25 + #22 + #14 ] / 4 ] (Y UNIT) 
#123= 0

( CONVERSION NO LONGER NEEDED )
(#106= [ #20255 * 25.4 / #5 ] X PARAMETER) 
(#107= [ #20256 * 25.4 / #5 ] Y PARAMETER) 

#106= [ #121 / #5 ] (X PARAMETER) 
#107= [ #122 / #5 ] (Y PARAMETER) 

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10011[44]*#10012[44]*#10013[44]*#10016[44]*#10017[44]*#10018[44]]
DPRNT[NEW MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[END*DATA] 
PCLOS 
G103

(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 

(MOVE BACK TO FIRST LOCATION) 
G00 G53 Z0. 
G00 G53 C0. B0. X#13 Y#14 

(------------------------------------) 

( TILT ) 

( CALC B90C0 DEG LOCATION) 
( TILT ) 

( SET FIXTURE LOCATION ) 
#15801= [ #10 + #18 ] (X) 
#15802= #14 (Y) 
#15803= [ #12 - #16 ] (Z) 

( MOVE TO 90 DEG LOCATION ) 
G154 P91 
G00 G53 Z0. 
G00 G154 P91 X0. Y0. 
(G00 G53 X [ -20. * [ #5 ] ])
G00 G154 P91 C0. B90.  
M00 
(CHECK THE POSITION) 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0. 
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G65 P9833 
G04 P100 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(PROBE LOCATION SECOND TIME FOR BETTER POSITIONING) 
G00 G154 P91 X0. Y0. 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
( CN 210115 ) 
#24= #15801 (X) 
#25= #15802 (Y) 
#26= #15803 (Z) 
#27= [ #24 - #13 ] ( INC TO CENTER X) 
#28= [ [ SQRT[ 3 ] ] * #27 ] ( INC TO CENTER Z) 
#28= [ ABS[ #28 ] ] 
(++++++++++++++++++)
#15804= #5024
#15805= #5025 
#15806= #5026 
(++++++++++++++++++)

(****************************************************) 
POPEN

DPRNT[UNITS*#4006[20]] 
DPRNT[TYPE*2] 
#10011= FIX[ #3011 / 10000 ] 
#10012= FIX[ [ #3011 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3011 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[DATE*20#10011[40]*#10012[20]*#10013[20]] 
#10011= FIX[ #3012 / 10000 ] 
#10012= FIX[ [ #3012 - [ #10011 * 10000 ] ] / 100 ] 
#10013= FIX[ [ #3012 - [ #10011 * 10000 ] - [ #10012 * 100 ] ] / 1 ] 
DPRNT[TIME*#10011[20]*#10012[20]*#10013[20]] 
DPRNT[AXISLABELS*A*B*C*X*Y*Z] 

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

#10121= #20255
#10122= #20256
#10123= #20257

DPRNT[B AXIS]
DPRNT[OLD MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[#10013[44]*#10011[44]*#10012[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 

G103 P1 
G04 P1. 
G04 P1 
G04 P1 
G04 P1 

(NEW ROTARY CENTER Z LOCATION) 

#123= [ [ #15 + #26 ] + [ #24 - #13 ] ] (Z) 
#123= [ #123 / 2 ] 
#108= [ #123 / #5 ] 
#108= [ #108 ] 

#124= [ [ #13 + #24 ] + [ #15 - #26 ] ] (Z) 
#124= [ #124 / 2 ] 
#109= [ #124 / #5 ] 
#109= [ #109 ]
#110= [ #106 - #109 ] 

(------------------------------------) 

( CALC B90C90 DEG LOCATION) 
( TILT ) 

( SET FIXTURE LOCATION ) 
#15801= #24 (X) 
#15802= [ #25 + #16 + #17 ] (Y) 
#15803= [ #26 + #16 - #17 ] (Z) 

( MOVE TO B90C90 DEG LOCATION ) 
G154 P91 
G00 G53 Z0. 
G00 G154 P91 C90. B90. 
G00 G154 P91 X0. Y0. 
(CHECK THE POSITION) 
( CN 210115 ) 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G65 P9833 
G04 P100 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(PROBE LOCATION SECOND TIME FOR BETTER POSITIONING) 
G00 G154 P91 X0. Y0. 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#21= #15801 (X) 
#22= #15802 (Y) 
#23= #15803 (Z) 
(++++++++++++++++++)
#15804= #5024
#15805= #5025 
#15806= #5026 
(++++++++++++++++++)

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10013[44]*#10011[44]*#10012[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 
 
(------------------------------------) 

( CALC B90C180 DEG LOCATION) 
( TILT ) 

( SET FIXTURE LOCATION ) 
#15801= #24 (X) 
#15802= [ #25 + #17 + #17 ] (Y) 
#15803= [ #26 + #16 + #16 ] (Z) 

( MOVE TO B90C90 DEG LOCATION ) 
G154 P91 
G00 G53 Z0. 
G00 G154 P91 C180. B90. 
G00 G154 P91 X0. Y0. 
(CHECK THE POSITION) 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G65 P9833 
G04 P100 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(PROBE LOCATION SECOND TIME FOR BETTER POSITIONING) 
G00 G154 P91 X0. Y0. 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#19= #15801 (X) 
#20= #15802 (Y) 
#15= #15803 (Z) 
(++++++++++++++++++)
#15804= #5024
#15805= #5025 
#15806= #5026 
(++++++++++++++++++)

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10013[44]*#10011[44]*#10012[44]*#10016[44]*#10017[44]*#10018[44]]
(****************************************************)  
#15804=0
#15805=0 
#15806=0 

(------------------------------------) 

( CALC B90C270 DEG LOCATION) 
( TILT ) 

( SET FIXTURE LOCATION ) 
#15801= #24 (X) 
#15802= [ #25 - #16 + #17 ] (Y) 
#15803= [ #26 + #16 + #17 ] (Z) 

( MOVE TO B90C90 DEG LOCATION ) 
G154 P91 
G00 G53 Z0. 
G00 G154 P91 C270. B90. 
G00 G154 P91 X0. Y0. 
(CHECK THE POSITION) 
G43 H#3026 

(PROBE LOCATION) 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G65 P9833 
G04 P100 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(PROBE LOCATION SECOND TIME FOR BETTER POSITIONING) 
G00 G154 P91 X0. Y0. 
G65 P9832 
G04 P1. 
G65 P9810 Z [ #2 * 0.75 ] 
G04 P100 
G65 P9811 S154.91 Z0. 
G04 P100 
X [ #2 * -0.75 ]
Z - [ #4 / 2 ]
G65 P9811 S154.91 X0.  
Z [ #2 * 0.75 ]
X0.
G04 P100 
G65 P9812 S154.91 Y#2 Z - [ #4 / 2 ]
G103 P1 
G00 G53 Z0. 
G65 P9833 
G04 P100 

G103 P1 

(MOVE Z OFFSET - HALF GAGE BALL DIAMETER) 
#15801= #15801 + [ #2 / 2 ]
#15803= #15803 - [ #2 / 2 ] 

(RECORD PROBED LOCATION) 
#27= #15801 (X) 
#28= #15802 (Y) 
#29= #15803 (Z) 
(++++++++++++++++++)
#15804= #5024
#15805= #5025 
#15806= #5026 
(++++++++++++++++++)

G103 P1 
G04 P1. 
G04 P1 
G04 P1 
G04 P1 

(NEW ROTARY CENTER LOCATION) 
#121= [ [ #23 + #15 + #29 + #26 ] / 4 ] (Z UNIT) 
#122= [ [ #22 + #20 + #28 + #25 ] / 4 ] (Y UNIT) 

#121= #26 - #121 (INCREMENTAL Z) 

#121= #13 - #121 (X UNIT) 

#111= [ #121 / #5 ] (X PARAMETER) 
#112= [ #122 / #5 ] (Y PARAMETER) 

(****************************************************) 
POPEN

#10011=#15804  
#10012=#15805 
#10013=#15806 
#10016=#15801
#10017=#15802
#10018=#15803

#10011= [ ROUND[ #10011 * 10000 ] ] / 10000 
#10012= [ ROUND[ #10012 * 10000 ] ] / 10000 
#10013= [ ROUND[ #10013 * 10000 ] ] / 10000 
#10016= [ ROUND[ #10016 * 10000 ] ] / 10000 
#10017= [ ROUND[ #10017 * 10000 ] ] / 10000 
#10018= [ ROUND[ #10018 * 10000 ] ] / 10000 

DPRNT[#10013[44]*#10011[44]*#10012[44]*#10016[44]*#10017[44]*#10018[44]]
DPRNT[NEW FINAL MRZP VALUES]
DPRNT[#10121[44]*#10122[44]*#10123[44]]
DPRNT[END*DATA] 
PCLOS 
G103

(****************************************************)
#15804=0
#15805=0 
#15806=0 

(=======================================) 

(MOVE BACK TO FIRST LOCATION) 
G00 G90 G53 Z0. 
G00 G90 G53 C0. B0. 
G00 G90 G53 X#13 Y#14 
GOTO9991 

(--------------------------------------) 

N900 ( ALARMS ) 

N901 
#3000= 1 ( NO A CALL IN G65 LINE ) 

N902 
#3000= 2 ( NO B CALL IN G65 LINE ) 

N903 
#3000= 3 ( NO C CALL IN G65 LINE ) 

N904 
#3000= 4 (HOME C AXIS ) 

N905 
#3000= 5 (HOME B AXIS ) 

N906 
#3000= 6 (SETTING 255 IS 0 - RUN MRZP ROUGH 1ST & ENTER VALUE) 
 
N907 
#3000= 7 (SETTING 256 IS 0 - RUN MRZP ROUGH 1ST & ENTER VALUE) 
 
N908 
#3000= 8 (SETTING 257 IS 0 - RUN MRZP ROUGH 1ST & ENTER VALUE) 

N9991 
G103 
M30 





%